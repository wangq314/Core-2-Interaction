<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <title>About Typing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/peterhry/CircleType@2.3.1/dist/circletype.min.js"></script>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@600&display=swap" rel="stylesheet">
  <link  href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
	 crossorigin="anonymous" />
</head>

<body>

	<div id="main" class="container main">
	<div class="text-container" id="text-container">
        <span id="first-column"></span>
        <span id="second-column"></span>
    </div>
    <img class="outer-circle" src="images/1.png">
    <img class="inner-circle" src="images/smallcircle.svg">
    <img id="arrow" src="images/Arrow.svg">
    <div class="ball-axis"><div class="ball" class=""></div></div>

  <script
    src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
    integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"></script>
  <script>
    'use strict';

    let main = document.getElementById('main');
    let textContainer = document.getElementById('text-container');
    let resultsContainer = document.getElementById('results');
    let wpmText = document.getElementById('wpm');
    let accuracyText = document.getElementById('accuracy');
    let timeText = document.getElementById('time');
    let firstColumn = document.getElementById('first-column');
    let secondColumn = document.getElementById('second-column');
    let arrow = document.getElementById('arrow');

    const invalidKeys = 'F1 F2 F3 F4 F5 F6 F7 F8 F9 F10 F11 F12 Escape Tab CapsLock Shift Control Alt Meta ArrowLeft ArrowRight ArrowDown ArrowUp Enter'.split(
        " ",
    );
    let errors = [];
    const textContent = ["Introduction: Typing is the process of writing or inputting text by pressing keys on a typewriter, computer keyboard, mobile phone, or calculator. It can be distinguished from other means of text input, such as handwriting and speech recognition. Text can be in the form of letters, numbers and other symbols. The world's first typist was Lillian Sholes from Wisconsin in the United States, the daughter of Christopher Sholes, who invented the first practical typewriter. User interface features such as spell checker and autocomplete serve to facilitate and speed up typing and to prevent or correct errors the typist may make. ", 
    "Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.",
    "It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribution of letters, as opposed to using 'Content here, content here', making it look like readable English. Many desktop publishing packages and web page editors now use Lorem Ipsum as their default model text, and a search for 'lorem ipsum' will uncover many web sites still in their infancy. Various versions have evolved over the years, sometimes by accident, sometimes on purpose (injected humour and the like)."]

   
    let textArr = [];
    let htmlArr = []

    let firstTime = true;
    let currentPos = 0;
    let backspaceNeeded = false;
    let currentTime = 0;
    let repeat;
    let textIndex = 0;

    function setArrowRotation(index) {
        anime({
            targets: '.ball-axis',
            rotate: index * 30 // -> '540deg'
        });
    }

    function startSpinning(element) {
        element.classList.add("rotate_animation")
        setTimeout(() => {
            updateNextPage()
            element.classList.remove("rotate_animation")

        }, 60000)
    }

    function setText(textString) {
        function column_is_full(column) {
            return (column.offsetHeight >= main.offsetHeight - 5)
        }
        textArr = textString.split('');
        htmlArr = textArr.map((item, index, array) => {
            if (item === ' ') {
                return `<span class="space" id="span${index}">${item}</span>`;
            }
            return `<span class="char" id="span${index}">${item}</span>`;
        });

        let first_column_is_full = false;
        for (let i = 0; i < htmlArr.length; i += 1) {
            if (!first_column_is_full) {
                firstColumn.insertAdjacentHTML('beforeend', htmlArr[i])
                if (column_is_full(firstColumn) && firstColumn.lastChild.innerHTML === ' ') {
                    first_column_is_full = true;
                }
            } else {
                secondColumn.insertAdjacentHTML('beforeend', htmlArr[i])
            }
        }
    }


    setText(textContent[0])

    function updateNextPage() {
        textIndex = (textIndex + 1) % textContent.length;
        let currentText = textContent[textIndex]
        textArr = [];
        htmlArr = []

        firstTime = true;
        currentPos = 0;
        backspaceNeeded = false;
        currentTime = 0;
        repeat = null;
        firstColumn.innerHTML = '';
        secondColumn.innerHTML = '';
        setText(currentText)
        setArrowRotation(textIndex)
        document.removeEventListener('keydown', keydownEventListener);
        document.addEventListener('keydown', keydownEventListener);
    }

    


    function keydownEventListener(event) {
        if (event.key === ' ') {
            event.preventDefault();
        }
        if (firstTime) {
            firstTime = false;
            startSpinning(arrow)
            repeat = setInterval(() => currentTime++, 1000);
        }
        if (event.location === 0 && !invalidKeys.includes(event.key)) {
            handleKey(event.key);
        }
    }

    document.addEventListener('keydown', keydownEventListener);

    function handleKey(key) {
        let span = document.getElementById(`span${currentPos}`).style;
        if (!backspaceNeeded) {
            if (key === textArr[currentPos]) {
                span.color = 'black';
                currentPos++;
            } else {
                if (textArr[currentPos] === ' ') {
                    span.backgroundColor = 'red';
                } else {
                    span.color = 'red';
                }
                backspaceNeeded = true;
                errors.push(textArr[currentPos]);
            }
        } else {
            if (event.key === 'Backspace') {
                if (textArr[currentPos] === ' ') {
                    span.backgroundColor = 'transparent';
                } else {
                    span.color = '#878787';
                }
                backspaceNeeded = false;
            }
        }
        if (currentPos === textArr.length) {
            clearInterval(repeat);
            handleEnd();
        }
    }

    function handleEnd() {
        let wpm = Math.floor(textArr.length / 5 / (currentTime / 60));
        let accuracy = Math.floor(
            ((textArr.length - errors.length) / textArr.length) * 100,
        );
        let multiples = Math.floor(currentTime / 60);
        let seconds = currentTime - multiples * 60;
        wpmText.innerHTML = `${wpm} wpm`;
        accuracyText.innerHTML = `${accuracy}%`;
        timeText.innerHTML = `${multiples} m ${seconds} s`;
        main.style.display = 'none';
        resultsContainer.style.display = 'block';
    }


    




  </script>

  
</body>
</html>
